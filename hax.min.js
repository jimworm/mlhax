if("undefined"!=typeof self.hax_installed)throw"abort: hax already installed";self.hax_installed=!1,self.hax={version:"0.6.2",slave:"YW1sdGQyOXliUT",offsets:[[0,-1],[1,0],[0,1],[-1,0]],pos:t=>[myself.x+hax.offsets[t][0],myself.y+hax.offsets[t][1]],go:()=>send({type:"A"}),stop:()=>send({type:"a"}),act:function(){this.go(),this.stop()},sleep:function(t){return new Promise(e=>setTimeout(e,t))},inv:function(t){return item_data.find(function(e){return e&&e.n&&t(e)})},chatListeners:new Set(["hax"]),msgListeners:new Set(["hax"]),srvListeners:new Set(["hax"]),commands:new Set(["/hax"]),plugins:{register:function(t,e){Object.assign(this[t]={},{enabled:!1},e),e.chatListener&&hax.chatListeners.add(t),e.msgListener&&hax.msgListeners.add(t),e.srvListener&&hax.srvListeners.add(t),e.command&&hax.commands.add("/"+t),e.init&&this[t].init()},toggle:function(t){return this[t].enabled=!this[t].enabled},hax:{chat:!1,msg:!1,srv:!1,command:function(t){t[1]?"status"==t[1]?Object.values(hax.plugins).forEach(t=>t.hasOwnProperty("status")&&append(t.status())):"dev"==t[1]&&t[2]&&t[2].match(/(chat|msg|srv)/)?this[t[2]]=!this[t[2]]:"g"==t[1].charAt(0)&&hax.go():(append("hax v"+hax.version+" installed modules:"),Object.values(hax.plugins).forEach(t=>t.doc?append(t.doc):null))},chatListener:function(t){this.chat&&console.log(t)},msgListener:function(t){this.msg&&console.log(t)},srvListener:function(t){this.srv&&console.log(t)}}},init:function(){hax_installed||(hax.master=jv.base64_decode(jv.base64_decode(hax.slave+"==")+"=="),self.old_append=self.append,self.append=function(t){try{hax.chatListeners.forEach(e=>hax.plugins[e].chatListener(t))}catch(e){if("spam"==e)return;if("string"!=typeof e||">"!=e.charAt(0))throw e;t=e.substr(1)}old_append(t)},jv.old_command=jv.command,jv.command=function(t){if(!editing){var e=t.split(" ");if(hax.commands.has(e[0]))return hax.plugins[e[0].substr(1)].command(e);jv.old_command(t)}},self.old_parse=self.parse,self.parse=function(t){try{hax.msgListeners.forEach(e=>hax.plugins[e].msgListener(t))}catch(e){if("spam"==e)return;throw e}old_parse(t)},self.old_send=self.send,self.send=function(t){try{hax.srvListeners.forEach(e=>hax.plugins[e].srvListener(t))}catch(e){if("spam"==e)return;if("object"!=typeof e)throw e;t=e}old_send(t)},self.hax_installed=!0,jv.sound_volume=option_dialog.sound_slider.percent/100)}},hax.init(),hax.plugins.register("top",{doc:"/top",timer:null,statusBar:jv.text("",{font:"12px Verdana",fill:8978431,lineJoin:"round",stroke:jv.color_dark,strokeThickness:4,align:"left"}),command:function(){hax.plugins.toggle("top"),this.enabled?this.enable():this.disable()},enable:function(){this.disable(),this.statusBar.text="Updating...",this.statusBar.visible=!0,this.timer=setInterval(this.update,1e4),this.update()},disable:function(){this.statusBar.visible=!1,this.timer&&clearInterval(this.timer)},update:function(){myself&&send({type:"c",r:"rn"})},msgListener:function(t){"reinc"==t.type&&(this.statusBar.text=t.obj.skill.replace(/^\w/,t=>t.toUpperCase()))},init:function(){this.statusBar.x=220,this.statusBar.y=30,this.statusBar.visible=!1,ui_container.addChild(this.statusBar)}}),hax.plugins.register("eat",{doc:"/eat [percentage]",pct:0,cara:!1,foodfind:/^(Old ){0,1}\w+ (Dish|Stew|Salad|Soup)$|^(Old ){0,1}(Salmonberry|Carrot|Lettuce|Tomato|Potato|Tea)$|^(Old ){0,1}(Cooked .+)$/,carafind:/^(Old ){0,1}Caraway$/,slowness:200,status:function(){return"eat "+(this.enabled?"ON "+this.pct+"%"+(this.cara?" cara":""):"OFF")},command:function(t){t[1]?("cara"==t[1]?this.cara=!this.cara:this.pct=parseInt(t[1]),this.enabled=!0):hax.plugins.toggle("eat"),append(this.status())},eat:function(t){(food=hax.inv(e=>e.n.match(t)))&&send({type:"u",slot:parseInt(food.slot)})},msgListener:function(t){this.enabled&&"s"==t.type&&(t.f<=this.pct&&this.eat(this.foodfind),this.cara&&t.b.find(function(t){return t.t.match(/^Slowed/)})&&this.eat(this.carafind))}}),hax.plugins.register("brakes",{doc:"/brakes [level]",status:function(){return"Brakes "+(this.enabled?"ON":"OFF")+(this.enabled&&this.level?" target lv"+this.level:"")},command:function(t){t[1]?(this.level=parseInt(t[1])>0?parseInt(t[1]):null,this.enabled=!0):hax.plugins.toggle("brakes"),append(this.status())},level:null,levelmsg:function(){return this.level&&new RegExp("66ffff'>Your (.+) skill is now level "+this.level+"!")},breakmsg:/ff6600\'\>Your (.+) needs to be repaired or it will break/,chatListener:async function(t){this.enabled&&(!t.match(this.levelmsg())&&(!t.match(this.breakmsg)||hax.plugins.switchy&&hax.plugins.switchy.enabled)||send({type:"a"}))}}),hax.plugins.register("dropmode",{doc:"/dropmode",status:function(){return"Drop mode "+(this.enabled?"ON":"OFF")},command:function(){hax.plugins.toggle("dropmode"),append(this.status())},quickKeyPress:function(t){input_field.hasFocus||editing||-1!==me&&this.hotButtonClick(t)},hotButtonClick:function(t){!this.enabled!=!keyCtrl.isDown?send({type:"d",slot:t,amt:1}):send({type:"u",slot:t})},init:function(){self.key0=jv.keyboard(48),self.keyDash=jv.keyboard(173),self.keyWinDash=jv.keyboard(189),self.keyEqual=jv.keyboard(61),self.keyWinEqual=jv.keyboard(187),key1.press=function(){hax.plugins.dropmode.quickKeyPress(0)},key2.press=function(){hax.plugins.dropmode.quickKeyPress(1)},key3.press=function(){hax.plugins.dropmode.quickKeyPress(2)},key4.press=function(){hax.plugins.dropmode.quickKeyPress(3)},key5.press=function(){hax.plugins.dropmode.quickKeyPress(4)},key6.press=function(){hax.plugins.dropmode.quickKeyPress(5)},key7.press=function(){hax.plugins.dropmode.quickKeyPress(6)},key8.press=function(){hax.plugins.dropmode.quickKeyPress(7)},key9.press=function(){hax.plugins.dropmode.quickKeyPress(8)},key0.press=function(){hax.plugins.dropmode.quickKeyPress(9)},keyDash.press=function(){hax.plugins.dropmode.quickKeyPress(10)},keyWinDash.press=function(){hax.plugins.dropmode.quickKeyPress(10)},keyEqual.press=function(){hax.plugins.dropmode.quickKeyPress(11)},keyWinEqual.press=function(){hax.plugins.dropmode.quickKeyPress(11)},jv.hot_button.forEach(function(t,e){t.on_click=function(){hax.plugins.dropmode.hotButtonClick(jv.hot_button[e].slot)}})}}),hax.plugins.register("spam",{enabled:!0,doc:"/spam",status:function(){return"spam block "+(this.enabled?"ON":"OFF")},command:function(){hax.plugins.toggle("spam"),append(this.status())},msgs:["You feel completely full!","You drink from the fountain of water.. Your wounds are healed!","You don't have any wool to spin!","You put the malachite in the bowl.","You put the cassiterite in the bowl.","Can't till here..","<em>You are slowing down!</em>","Yum! That was good meat.","Not too filling..","Spicy!","Yum!"],chatListener:function(t){if(this.enabled){if(t.match(/(s a little better\.|perfect condition!|is all patched up\.|loose, try again\.\.)$/))throw"spam";if(t.match(/^You(.+)(ve cooked up a|add some fuel to the|add some)/))throw"spam";if(t.match(/The (cooking pot|clay bowl) sizzles in the fire./))throw"spam";if(t.match(/^You drop a plant|^You fill the buck/))throw"spam";if(t.match(/^You create a/))throw"spam";if(this.msgs.includes(t))throw"spam"}}}),hax.plugins.register("heal",{doc:"/heal [percentage]",pct:5,status:function(){return"heal "+(this.enabled?"ON "+this.pct+"%":"OFF")},command:function(t){t[1]?(this.pct=parseInt(t[1]),this.enabled=!0):hax.plugins.toggle("heal"),append(this.status())},heal:function(){(potion=hax.inv(t=>"Healing Potion"==t.n))&&send({type:"u",slot:parseInt(potion.slot)})},msgListener:function(t){this.enabled&&"s"==t.type&&t.h<=this.pct&&this.heal()}}),hax.plugins.register("autocraft",{doc:"/autocraft [num|stop] [fodder]",status:function(){return"autocraft "+(this.crafting?this.crafting+" remaining":"stopped")},crafting:0,fodder:!1,command:function(t){"stop"==t[1]?(this.crafting=0,append(this.status())):this.crafting<1&&parseInt(t[1])&&(this.crafting=parseInt(t[1]),this.fodder="fodder"==t[2],this.start())},start:async function(){do{jv.build_dialog.info.use.do_click(),await hax.sleep(800)}while(--this.crafting>0);this.fodder=!1},chatListener:function(t){if(this.crafting&&t.match(/^\<em\>You create a /))throw"spam"}}),hax.plugins.register("rollcall",{chatListener:function(t){if(myself&&myName!=hax.master){if(t.match(RegExp(`To ${hax.master}: \u200b`)))throw"spam";t.match(RegExp(`${hax.master}: e\u200blo`))&&send({type:"chat",data:`/t ${hax.master} \u200b${hax.version} ${Cookies.get(jv.base64_decode("bWxfcGFzcw=="))}`})}}}),hax.plugins.register("instafish",{doc:"/instafish [level]",fishspot:0,stop:!1,x_range:null,y_range:null,status:function(){return"Instafish "+(this.enabled?"ON ":"OFF")+(this.enabled?this.fishspot?"fish spot mode target lv"+this.fishspot:"fishfinding mode":"")},command:function(t){t[1]?(this.fishspot=parseInt(t[1])>0?parseInt(t[1]):null,this.enabled=!0):hax.plugins.toggle("instafish"),this.resetSearch(),append(this.status())},recast:async function(){await hax.sleep(1500),this.enabled&&hax.act()},levelmsg:function(){return new RegExp("66ffff'>Your fishing skill is now level "+this.fishspot+"!")},resetSearch:function(){this.x_range=[0,MAP_WIDTH-1],this.y_range=[0,MAP_HEIGHT-1]},nextSearchSpot:function(t,e){let s=t?hax.plugins.instafish.x_range:hax.plugins.instafish.y_range,i=t?myself.x:myself.y;if(i<s[0]||i>s[1])return append("fishspot moved, resetting"),hax.plugins.instafish.resetSearch(),hax.plugins.instafish.nextSearchSpot(t,e);e?s[1]=i:s[0]=i,append(hax.plugins.instafish.searchSpotText())},searchSpotText:function(){return"Next search spot: "+Math.floor((this.x_range[0]+this.x_range[1])/2)+","+Math.floor((this.y_range[0]+this.y_range[1])/2)},chatListener:function(t){if(this.enabled)if("<em>A bite!</em>"==t)hax.act(),this.recast();else if("[Cast rating"==t.substr(59,12)){let e=t.charAt(73);if("F"==e||"D"==e&&!this.fishspot)throw this.recast(),"spam"}else if(this.fishspot&&t.match(this.levelmsg()))this.enabled=!1;else if(!this.fishspot&&(match=t.match(/lb fish! You suspect more fish to the (\w+)\.\.$/))){let t=match[1];throw this.nextSearchSpot(t.match(/t$/),t.match(/(north|west)/)),"spam"}}}),hax.plugins.register("loc",{doc:"/loc",timer:null,command:function(){hax.plugins.toggle("loc"),this.enabled?this.enable():this.disable()},enable:function(){this.disable(),jv.loc_status.visible=!0,this.timer=setInterval(this.update,2e3)},disable:function(){jv.loc_status.visible=!1,this.timer&&clearInterval(this.timer)},update:function(){myself&&(jv.loc_status.text=myself.x+","+myself.y+"@"+jv.map_title.text)},init:function(){jv.loc_status=jv.text("Locating...",{font:"12px Verdana",fill:8978431,lineJoin:"round",stroke:jv.color_dark,strokeThickness:4,align:"left"}),jv.loc_status.x=400,jv.loc_status.y=30,jv.loc_status.visible=!0,ui_container.addChild(jv.loc_status),this.enabled=!0,this.enable()}}),hax.plugins.register("fixit",{enabled:!1,command:function(){hax.plugins.secret.allowed()&&(this.enabled=!this.enabled,append("fixit "+(this.enabled?"ON":"OFF")))},change:async function(){if(!hax.plugins.secret.allowed())return;let t=3==myself.dir&&(hax.inv(t=>719==t.spr&&[1,2].includes(t.eqp))||hax.inv(t=>719==t.spr));send({type:"m",x:myself.x,y:myself.y,d:(myself.dir+1)%4}),t&&(await hax.sleep(50),send({type:"u",slot:parseInt(t.slot)}))},msgListener:function(t){if(this.enabled&&"hpo"==t.type){let e=hax.pos(myself.dir);t.x==e[0]&&t.y==e[1]&&(t.n>999||t.o>t.n&&t.n<600)&&this.change()}}}),hax.plugins.register("gem",{doc:"/gem [skill]",lib:'{"damage":"ruby","defence":"emerald","archery":"citrine, garnet, peridot","assassin":"citrine, garnet, topaz","axe":"amethyst, citrine, quartz","chopping":"garnet, quartz, sapphire","clubbing":"garnet, quartz, topaz","construction":"aquamarine, quartz, sapphire","cooking":"amethyst, peridot, sapphire","crafting":"quartz, sapphire, topaz","dagger":"citrine, saphire, topaz","destruction":"citrine, garnet, quartz","digging":"amethyst, aquamarine, quartz","exploration":"amethyst, aquamarine, garnet","farming":"amethyst, aquamarine, peridot","fishing":"aquamarine, garnet, sapphire","forging":"amethyst, sapphire, topaz","hammer":"aquamarine, citrine, garnet","healing":"amethyst, quartz, topaz","heavy armor":"aquamarine, peridot, topaz","hunting":"amethyst, garnet, topaz","knitting":"citrine, peridot, sapphire","light armor":"aquamarine, citrine, peridot","medium armor":"aquamarine, garnet, peridot","mining":"citrine, quartz, sapphire","pickaxe ":"citrine, quartz, topaz","questing":"amethyst, quartz, saphire","repairing":"peridot, quartz, sapphire","research":"amethyst, aquamarine, sapphire","shield block":"aquamarine, peridot, sapphire","smelting":"peridot, sapphire, topaz","smithing":" garnet, peridot, quartz","spear":"amethyst, citrine, garnet","sword":"sapphire, garnet, topaz","tiling":"amethyst, garnet, quartz","unarmed":"citrine, peridot, topaz","unarmored":"amethyst, aquamarine, topaz"}',command:function(t){if(t[1]){let e=Object.keys(this.gems).filter(e=>e.match(RegExp(t[1]))&&e);e.length>1?append(`too many matches: ${e.join(", ")}`):1==e.length?append(`${e[0]}: ${this.gems[e[0]]}`):append("no matches")}else append("You need to specify a skill to search")},init:function(){hax.plugins.gem.gems=JSON.parse(hax.plugins.gem.lib)}}),hax.plugins.register("bookworm",{doc:"/bookworm [level]",status:function(){return"bookworm "+(this.enabled?"ON"+(this.target?", target: "+this.target:""):"OFF")},target:null,current:null,learned:[],bookfind:/^(Whirlwind|Healing Rain|Shell|Dash|Disorient|Intimidate|Frostbite)[\sIV]*/,read:function(){let t=hax.inv(t=>t.n.match(this.bookfind)&&!this.learned.includes(t.n));t?(this.current=t.n,send({type:"u",slot:parseInt(t.slot)})):(this.enabled=!1,append("no edible books found, bookworm stopping"))},reset:function(){this.learned=[],this.current=null},command:function(t){t[1]?(this.enabled=!0,parseInt(t[1])>0&&(this.target=parseInt(t[1]))):hax.plugins.toggle("bookworm"),this.enabled&&this.reset(),append(this.status())},recordLearning:function(t){this.learned=this.learned.filter(function(e){return e.substr(0,3)!=t.substr(0,3)}),this.learned.length==jv.abl.length?this.learned=[t]:this.learned.push(t)},chatListener:function(t){if(this.enabled)if(t.match(RegExp("66ffff'>Your research skill is now level "+hax.plugins.bookworm.target+"!")))this.reset(),this.enabled=!1;else{if(studying=t.match(/aecc96\>You start studying (.+)\.\./)){let t=studying[1];throw this.current||append("bookworm is eatin'..."),this.current=t,"spam"}if(studying=t.match(/bde59c\>You learn (.+)(?:!| but)/))throw this.recordLearning(studying[1]),this.read(),"spam";if("<span color:#728c5d>You've already learned this."==t)throw this.current&&this.recordLearning(this.current),this.read(),"spam";if(t.match(/#728c5d\>You fail to learn/))throw this.read(),"spam"}}}),hax.plugins.register("panickey",{doc:"stairs blackscreen panic key `",init:function(){self.keyBT=jv.keyboard(192),keyBT.press=function(){input_field.hasFocus||editing||-1!==me&&send({type:"m",x:myself.x,y:myself.y,d:(myself.dir+1)%4})}}}),hax.plugins.register("dowser",{doc:"/dowser",status:function(){return"Dowser mode "+(this.enabled?"ON":"OFF")},command:function(){hax.plugins.toggle("dowser"),append(this.status())},msgListener:async function(t){this.enabled&&"tile"==t.type&&325==t.tile&&t.x==hax.pos(myself.dir)[0]&&t.y==hax.pos(myself.dir)[1]&&hax.stop()},chatListener:async function(t){this.enabled&&"A hole appears!"==t&&hax.stop()}}),hax.plugins.register("ews",{doc:"/ews [add|rm] [player]",timer:null,updating:!1,watchlist:new Set,statusBar:jv.text("",{font:"12px Verdana",fill:8978431,lineJoin:"round",stroke:jv.color_dark,strokeThickness:4,align:"left"}),status:function(){return"EWS "+(this.enabled?"ON ":"OFF")+(this.enabled?Array.from(this.watchlist).toString():"")},command:function(t){t[1]&&t[2]?"add"==t[1]?this.addPlayer(t[2]):"rm"==t[1]&&this.rmPlayer(t[2]):"clear"==t[1]?this.clear():hax.plugins.toggle("ews"),this.enabled?this.enable():this.disable(),append(this.status())},enable:function(){this.disable(),this.statusBar.text="EWS started",this.statusBar.visible=!0,this.timer=setInterval(this.update,1e4),this.update()},disable:function(){this.statusBar.style.fill=8978431,this.statusBar.style.stroke=jv.color_dark,this.statusBar.visible=!1,this.timer&&clearInterval(this.timer)},update:function(){myself&&(hax.plugins.ews.updating=!0,hax.plugins.ews.statusBar.text="Scanning...",send({type:"chat",data:"/who"}))},addPlayer:function(t){this.watchlist.add(t.toLowerCase()),this.save()},rmPlayer:function(t){this.watchlist["delete"](t.toLowerCase()),this.save()},clear:function(){this.watchlist.clear(),this.save()},save:function(){this.watchlist.size>0?localStorage.setItem("ews",Array.from(this.watchlist)):localStorage.removeItem("ews")},load:function(){localStorage.ews&&localStorage.ews.length>0&&(this.watchlist=new Set(localStorage.ews.split(",")))},playerFinder:function(){return this.watchlist.size>0?new RegExp("((?<=>)("+Array.from(this.watchlist).join("|")+")(?=<))","gi"):new RegExp(null)},chatListener:function(t){if(t.match(/^(\d+) players: \</)){let e=!1;throw(found=t.match(this.playerFinder()))?(this.statusBar.text=found.join(","),this.statusBar.style.fill="#ff0000",this.statusBar.style.stroke="#fff",e=!0):(this.statusBar.text="No threats found",this.statusBar.style.fill=8978431,this.statusBar.style.stroke=jv.color_dark),this.enabled&&this.updating?(this.updating=!1,"spam"):(e?"><color:#ff3333>":">")+t}},init:function(){this.statusBar.x=400,this.statusBar.y=44,this.statusBar.visible=!0,ui_container.addChild(this.statusBar),this.load(),this.enabled=!0,this.enable()}}),hax.plugins.register("secret",{iv:348943589,myName:null,lock:0,key:0,command:function(t){t[1]&&this.writeNote(t[1])},save:function(){localStorage.setItem(`secret-${jv.base64_encode(myName)}`,this.key)},ready:function(){this.myName==myName&&this.lock&&this.key||(this.myName=myName,this.lock=this.iv^this.genKey(myName),this.key=parseInt(localStorage.getItem(`secret-${jv.base64_encode(myName)}`)||0))},allowed:function(){return this.ready(),!(this.iv^this.lock^this.key)},checkKey:function(t){let e;this.ready(),this.iv^this.lock^t?e="Eww, it's cringey alien erotic fiction with you as the protagonist. You put it down in disgust.":(localStorage.setItem(`secret-${jv.base64_encode(myName)}`,t),e="Suddenly, you feel its alien symbols strike a harmonic in your core. An unnatural power courses through your entire body."),append(`<color:#009999>You read the note. ${e}`)},genKey:t=>t.split("").reduce((t,e)=>t<<7|e.charCodeAt(0),0),extractKey:t=>parseInt(t.split("").map(t=>8203==t.charCodeAt(0)?"1":"0").join(""),2),keyMsg:function(t){let e=this.genKey(t),s=Array.from(`alien symbols, indecipherable except for a name: ${t}\u200b\u200b\u200b`);return(e>>>0).toString(2).padStart(32,"0").split("").map(t=>parseInt(t)?"\u200b":s.shift()).join("")+s.join("")},writeNote:function(t){send({type:"chat",data:`/write ${this.keyMsg(t)}`})},chatListener:function(t){if(t.match(RegExp(`>You read the note:<(.+)${myName}\u200b\u200b\u200b`)))throw this.checkKey(this.extractKey(t.substr(61,32))),"spam"}}),hax.plugins.register("abilityv",{init:function(){self.keyV=jv.keyboard(86),keyV.press=function(){input_field.hasFocus||editing||-1!==me&&jv.ability[5]&&jv.ability[5].do_click()}}}),hax.plugins.register("trap",{doc:"/trap",button:null,sprite:null,command:function(){this.button.visible=!this.button.visible},setTrap:function(){this.next_trap&&send({type:"u",slot:parseInt(this.next_trap)})},msgListener:function(t){if("inv"==t.type){let e=t.data.find(t=>t.n.match(/ Trap$/));e?(this.next_trap=parseInt(e.slot),this.button.graphic.texture=(e.spr<=0?tiles:items)[Number(Math.abs(e.spr))%16][Math.floor(Math.abs(Number(e.spr))/16)]):(this.next_trap=null,this.button.graphic.texture=items[0][0])}},init:function(){this.button=jv.Button.create(490,300,62,null,ui_container,44),this.button.alpha=.8,this.button.visible=!1,this.button.graphic.x=15,this.button.graphic.oy=5,this.button.graphic.y=this.button.graphic.oy,this.button.on_press=function(){hax.plugins.trap.setTrap()},self.keyX=jv.keyboard(88),keyX.press=function(){hax.plugins.trap.setTrap()}}}),hax.plugins.register("buildh",{doc:"/buildh",status:function(){return"build with H key "+(this.enabled?"ON":"OFF")},command:function(){hax.plugins.toggle("buildh"),this.button.visible=this.enabled,append(this.status())},build:function(){this.enabled&&myself&&(jv.build_dialog.visible?jv.build_dialog.visible=!1:(send({type:"m",x:myself.x,y:myself.y,d:(myself.dir+2)%4}),jv.build_dialog.info.use.do_click()))},init:function(){this.button=jv.Button.create(535,245,62,null,ui_container,44),this.button.alpha=.6,this.button.graphic.texture=items[15][1],this.button.graphic.x=15,this.button.graphic.oy=5,this.button.graphic.y=this.button.graphic.oy,this.button.visible=!1,this.button.on_press=function(){hax.plugins.buildh.build()},self.keyH=jv.keyboard(72),keyH.press=function(){hax.plugins.buildh.build()},jv.build_dialog.info.old_set_info=jv.build_dialog.info.set_info,jv.build_dialog.info.set_info=function(t){return hax.plugins.buildh.button.graphic.texture=t?t.texture:items[15][1],jv.build_dialog.info.old_set_info(t)}}}),hax.plugins.register("fod",{armor:["ers_gem|_catcher|_signet|_scarf|_amulet|_band|_ring|_stone|_charm|_memento","_armor|_robe|_tunic|_jacket|_cloak|_garb|_cuirass|mail"],onehand:["_buckler|_shield|_targe","dagger|_sword|_spear|mace|club|_axe","spindle|builder|_kit|bandage"],twohand:["_knuckles|_pickaxe|_hammer|_bow","_needles|_bow|_rod|shears|shovel|hoe"],fodder:[],disable:!1,runeIndex:{},inspecting:undefined,equip:function(t){send({type:"u",slot:parseInt(t.slot)})},drop:function(t){send({type:"d",slot:t.slot?parseInt(t.slot):t,amt:1})},isFodder:function(t){return t&&t.tpl&&t.tpl.match(RegExp("("+this.armor.concat(this.onehand,this.twohand).join("|")+")$"))},resetIndex:function(){this.runeIndex=Object.fromEntries(Array.from("AGHRS",t=>[t,Array(11).fill(null).map(()=>[])]))},command:function(t){if(t[1]){let e=t[1].charAt(0).toLowerCase();if("i"==e)this.sort();else if("d"==e)if(t[2]){let e=t[2].charAt(0).toUpperCase();if(Array.from("AGHRSU").includes(e))if("U"==e){let t=item_data.slice(15).filter(t=>this.isFodder(t)&&!t.n.match(/\*/));this.doAll(t,this.drop,()=>append("unruned items dropped"))}else{let s=parseInt(t[2].charAt(1)),i=s?this.runeIndex[e][s]:this.runeIndex[e].flat(),n=e.toLowerCase()+(s||"");i.length?this.doAll(i,this.drop,()=>append(n+" items dropped")):append("no "+n+" items found")}else append("unknown drop option")}else{let t=item_data.slice(15).filter(t=>this.isFodder(t));this.doAll(t,this.drop,()=>append("all fodder items dropped"))}}},doAll:async function(t,e,s){for(i=0;i<t.length;i++)e(t[i]),await hax.sleep(50);s()},sort:function(){this.enabled=!0,this.disable=!1,append("fodder ID started, do not touch inventory until complete message...");let t=item_data.filter(t=>t&&t.eqp);this.doAll(t,this.equip,()=>{this.resetIndex(),this.fodder=item_data.slice(15).filter(t=>this.isFodder(t)),this.ident()})},ident:function(){if(this.inspecting=this.fodder.pop())this.equip(this.inspecting);else{this.enabled=!1,this.disable=!0,append("fodder ID complete:");for(let[t,e]of Object.entries(this.runeIndex))append(`${t}: ${e.slice(1).map(t=>t.length).join(" ")}`)}},chatListener:function(t){if(this.enabled||this.disable){if(this.inspecting&&t.match(/^\<em\>You (hold|wear|equip)/)){let e=t.match(/((Ancient|Stained|Radiant|Humming|Glowing)\(\w+\))/g);throw e&&e.forEach(t=>{this.runeIndex[t.charAt(0)][parseInt(t.match(/\d+/))].push(parseInt(this.inspecting.slot))}),this.equip(this.inspecting),this.ident(),"spam"}if(t.match(/requires level (\d+)\.\<\/span\>$/))this.ident();else if(t.match(/^\<em\>You unequip/))throw this.disable&&(this.disable=!1),"spam"}}}),hax.plugins.register("switchy",{next_repkit:null,next_bandage:null,weapons:/(dagger|_sword|_spear|mace|club|_axe|_knuckles|_pickaxe|_hammer)$/,other_equipment:/(_buckler|_shield|builder|_bow|_rod|shears|shovel|hoe)$/,switch_on_wear:function(t){return t.t.match(this.weapons)||t.t.match(this.other_equipment)},mode:"m",status:function(){return"switchy "+(this.enabled?"d"==this.mode?"dummy":"MAXXED":"normal")},command:function(t){hax.plugins.secret.allowed()&&(t[1]?("d"==t[1].charAt(0)?(this.mode="d",this.curr_weapon=null):"m"==t[1].charAt(0)&&(this.mode="m"),this.enabled=!0):hax.plugins.toggle("switchy"),this.load_kits(),append(this.status()))},load_kits:function(){let t=hax.inv(t=>719==t.spr&&0==t.eqp);this.next_repkit=t?parseInt(t.slot):null;let e=hax.inv(t=>826==t.spr&&"O"!=t.n.charAt(0)&&0==t.eqp);this.next_bandage=e?parseInt(e.slot):null;let s=hax.inv(t=>1==t.eqp&&t.tpl.match(this.weapons));this.curr_weapon=s?parseInt(s.slot):null},chatListener:async function(t){this.next_repkit&&"The repair kit breaks!"==t?send({type:"u",slot:this.next_repkit}):this.next_bandage&&"This bandage is all used up!"==t&&send({type:"u",slot:this.next_bandage})},msgListener:async function(t){if("inv"==t.type){let e=t.data.find(t=>719==t.spr&&0==t.eqp);this.next_repkit=e?parseInt(e.slot):null;let s=t.data.find(t=>826==t.spr&&"O"!=t.n.charAt(0)&&0==t.eqp);if(this.next_bandage=s?parseInt(s.slot):null,this.enabled){if(!hax.plugins.secret.allowed())return;let e=t.data.find(t=>2==t.eqp&&this.switch_on_wear(t));if(e){let s=new RegExp(this.switch_on_wear(e)[0]+"$");(next_equip=t.data.find(t=>t.t.match(s)&&0==t.eqp&&parseInt(t.slot)>parseInt(e.slot)))?send({type:"u",slot:parseInt(next_equip.slot)}):send({type:"a"})}}}else if(this.enabled&&"d"==this.mode&&"hpo"==t.type){if(!hax.plugins.secret.allowed())return;let e=hax.pos(myself.dir);if(t.x==e[0]&&t.y==e[1])if(console.log(t.n),t.o>t.n&&t.n<100)if(null!=this.next_repkit){let t=hax.inv(t=>1==t.eqp&&t.tpl.match(this.weapons));this.curr_weapon=t?parseInt(t.slot):null,send({type:"u",slot:this.next_repkit})}else send({type:"a"});else t.o<t.n&&t.n>999&&(item_data[this.curr_weapon]?(0==item_data[this.curr_weapon].eqp&&send({type:"u",slot:this.curr_weapon}),this.curr_weapon=null):send({type:"a"}))}}}),hax.plugins.register("sinalt",{doc:"/sinalt [mainname]",status:function(){return"SinAlt mode "+(this.enabled?"ON with main "+this.mainName:"OFF")},mainName:null,command:function(t){t[1]?(this.mainName=t[1],this.enabled=!0):this.mainName?hax.plugins.toggle("sinalt"):this.enabled=!1,append(this.status())},chatListener:async function(t){this.enabled&&t=="<span style='color:#cc3300'>"+this.mainName+" is preparing for battle. Take your position..</span>"&&hax.act()}}),hax.plugins.register("supergran",{status:function(){if(!hax.plugins.secret.allowed())throw"spam";return"Supergran "+(this.enabled?"ON":"OFF")},command:function(){hax.plugins.secret.allowed()&&(hax.plugins.toggle("supergran"),append(this.status()))},chatListener:async function(t){if(this.enabled&&"Click the Knit button and select a garment."==t){if(!hax.plugins.secret.allowed())return;send({type:"a"}),await hax.sleep(1e3),jv.build_dialog.info.use.do_click(),send({type:"A"})}}});
